import{bd as ut,aS as lt,aA as F,be as sr,bf as M,bg as nr,bh as ft,at as ht,b5 as dt,bi as ir,bj as ar,bk as pt,bl as Et}from"./index-Qy8TeGxy.js";const mt="transport";class Rt{exchangeTimeout=3e4;unresponsiveTimeout=15e3;deviceModel=null;tracer;constructor({context:n,logType:t}={}){this.tracer=new ut(t??mt,n)}static isSupported;static list;static listen;static open;exchange(n,{abortTimeoutMs:t}={}){throw new Error("exchange not implemented")}exchangeBulk(n,t){let r=!1;const s=()=>{r=!0};return(async()=>{if(!r)for(const c of n){const u=await this.exchange(c);if(r)return;const o=u.readUInt16BE(u.length-2);if(o!==sr.OK)throw new nr(o);t.next(u)}})().then(()=>!r&&t.complete(),c=>!r&&t.error(c)),{unsubscribe:s}}setScrambleKey(n){}close(){return Promise.resolve()}_events=new lt;on(n,t){this._events.on(n,t)}off(n,t){this._events.removeListener(n,t)}emit(n,...t){this._events.emit(n,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(n){this.exchangeTimeout=n}setExchangeUnresponsiveTimeout(n){this.unresponsiveTimeout=n}send=async(n,t,r,s,l=F.alloc(0),c=[sr.OK],{abortTimeoutMs:u}={})=>{const o=this.tracer.withUpdatedContext({function:"send"});if(l.length>=256)throw o.trace("data.length exceeded 256 bytes limit",{dataLength:l.length}),new M("data.length exceed 256 bytes limit. Got: "+l.length,"DataLengthTooBig");o.trace("Starting an exchange",{abortTimeoutMs:u});const a=await this.exchange(F.concat([F.from([n,t,r,s]),F.from([l.length]),l]),{abortTimeoutMs:u});o.trace("Received response from exchange");const e=a.readUInt16BE(a.length-2);if(!c.some(f=>f===e))throw new nr(e);return a};static create(n=3e3,t){return new Promise((r,s)=>{let l=!1;const c=this.listen({next:o=>{l=!0,c&&c.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,n).then(r,s)},error:o=>{u&&clearTimeout(u),s(o)},complete:()=>{u&&clearTimeout(u),l||s(new M(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=t?setTimeout(()=>{c.unsubscribe(),s(new M(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},t):null})}exchangeBusyPromise;async exchangeAtomicImpl(n){const t=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw t.trace("Atomic exchange is already busy"),new ft("An action was already pending on the Ledger device. Please deny or reconnect.");let r;const s=new Promise(u=>{r=u});this.exchangeBusyPromise=s;let l=!1;const c=setTimeout(()=>{t.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),l=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await n();return l&&(t.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{t.trace("Finalize, clearing busy guard"),clearTimeout(c),r&&r(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(n,t,r){for(const s of t)n[s]=this.decorateAppAPIMethod(s,n[s],n,r)}_appAPIlock=null;decorateAppAPIMethod(n,t,r,s){return async(...l)=>{const{_appAPIlock:c}=this;if(c)return Promise.reject(new M("Ledger Device is busy (lock "+c+")","TransportLocked"));try{return this._appAPIlock=n,this.setScrambleKey(s),await t.apply(r,l)}finally{this._appAPIlock=null}}}setTraceContext(n){this.tracer=this.tracer.withContext(n)}updateTraceContext(n){this.tracer.updateContext(n)}getTraceContext(){return this.tracer.getContext()}static ErrorMessage_ListenTimeout="No Ledger device found (timeout)";static ErrorMessage_NoDeviceFound="No Ledger device found"}const or=5;function vt(i){const n=F.alloc(2);return n.writeUInt16BE(i,0),n}const It={data:F.alloc(0),dataLength:0,sequence:0},gt=(i,n)=>({makeBlocks(t){let r=F.concat([vt(t.length),t]);const s=n-5,l=Math.ceil(r.length/s);r=F.concat([r,F.alloc(l*s-r.length+1).fill(0)]);const c=[];for(let u=0;u<l;u++){const o=F.alloc(5);o.writeUInt16BE(i,0),o.writeUInt8(or,2),o.writeUInt16BE(u,3);const a=r.slice(u*s,(u+1)*s);c.push(F.concat([o,a]))}return c},reduceResponse(t,r){let{data:s,dataLength:l,sequence:c}=t||It;if(r.readUInt16BE(0)!==i)throw new M("Invalid channel","InvalidChannel");if(r.readUInt8(2)!==or)throw new M("Invalid tag","InvalidTag");if(r.readUInt16BE(3)!==c)throw new M("Invalid sequence","InvalidSequence");t||(l=r.readUInt16BE(5)),c++;const u=r.slice(t?5:7);return s=F.concat([s,u]),s.length>l&&(s=s.slice(0,l)),{data:s,dataLength:l,sequence:c}},getReducedResult(t){if(t&&t.dataLength===t.data.length)return t.data}});var H={exports:{}},ie,cr;function K(){if(cr)return ie;cr=1;const i="2.0.0",n=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,s=n-6;return ie={MAX_LENGTH:n,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:i,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ie}var ae,ur;function Z(){if(ur)return ae;ur=1;var i={};return ae=typeof ht=="object"&&i&&i.NODE_DEBUG&&/\bsemver\b/i.test(i.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},ae}var lr;function z(){return lr||(lr=1,(function(i,n){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=K(),l=Z();n=i.exports={};const c=n.re=[],u=n.safeRe=[],o=n.src=[],a=n.safeSrc=[],e=n.t={};let f=0;const h="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[h,r]],N=w=>{for(const[O,b]of m)w=w.split(`${O}*`).join(`${O}{0,${b}}`).split(`${O}+`).join(`${O}{1,${b}}`);return w},p=(w,O,b)=>{const A=N(O),D=f++;l(w,D,O),e[w]=D,o[D]=O,a[D]=A,c[D]=new RegExp(O,b?"g":void 0),u[D]=new RegExp(A,b?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),p("MAINVERSION",`(${o[e.NUMERICIDENTIFIER]})\\.(${o[e.NUMERICIDENTIFIER]})\\.(${o[e.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${o[e.NUMERICIDENTIFIERLOOSE]})\\.(${o[e.NUMERICIDENTIFIERLOOSE]})\\.(${o[e.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${o[e.NONNUMERICIDENTIFIER]}|${o[e.NUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${o[e.NONNUMERICIDENTIFIER]}|${o[e.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASE",`(?:-(${o[e.PRERELEASEIDENTIFIER]}(?:\\.${o[e.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${o[e.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[e.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${h}+`),p("BUILD",`(?:\\+(${o[e.BUILDIDENTIFIER]}(?:\\.${o[e.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${o[e.MAINVERSION]}${o[e.PRERELEASE]}?${o[e.BUILD]}?`),p("FULL",`^${o[e.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${o[e.MAINVERSIONLOOSE]}${o[e.PRERELEASELOOSE]}?${o[e.BUILD]}?`),p("LOOSE",`^${o[e.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${o[e.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${o[e.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${o[e.XRANGEIDENTIFIER]})(?:\\.(${o[e.XRANGEIDENTIFIER]})(?:\\.(${o[e.XRANGEIDENTIFIER]})(?:${o[e.PRERELEASE]})?${o[e.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${o[e.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[e.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[e.XRANGEIDENTIFIERLOOSE]})(?:${o[e.PRERELEASELOOSE]})?${o[e.BUILD]}?)?)?`),p("XRANGE",`^${o[e.GTLT]}\\s*${o[e.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${o[e.GTLT]}\\s*${o[e.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),p("COERCE",`${o[e.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",o[e.COERCEPLAIN]+`(?:${o[e.PRERELEASE]})?(?:${o[e.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",o[e.COERCE],!0),p("COERCERTLFULL",o[e.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${o[e.LONETILDE]}\\s+`,!0),n.tildeTrimReplace="$1~",p("TILDE",`^${o[e.LONETILDE]}${o[e.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${o[e.LONETILDE]}${o[e.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${o[e.LONECARET]}\\s+`,!0),n.caretTrimReplace="$1^",p("CARET",`^${o[e.LONECARET]}${o[e.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${o[e.LONECARET]}${o[e.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${o[e.GTLT]}\\s*(${o[e.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${o[e.GTLT]}\\s*(${o[e.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${o[e.GTLT]}\\s*(${o[e.LOOSEPLAIN]}|${o[e.XRANGEPLAIN]})`,!0),n.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${o[e.XRANGEPLAIN]})\\s+-\\s+(${o[e.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${o[e.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[e.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(H,H.exports)),H.exports}var oe,fr;function Ze(){if(fr)return oe;fr=1;const i=Object.freeze({loose:!0}),n=Object.freeze({});return oe=r=>r?typeof r!="object"?i:r:n,oe}var ce,hr;function st(){if(hr)return ce;hr=1;const i=/^[0-9]+$/,n=(r,s)=>{const l=i.test(r),c=i.test(s);return l&&c&&(r=+r,s=+s),r===s?0:l&&!c?-1:c&&!l?1:r<s?-1:1};return ce={compareIdentifiers:n,rcompareIdentifiers:(r,s)=>n(s,r)},ce}var ue,dr;function _(){if(dr)return ue;dr=1;const i=Z(),{MAX_LENGTH:n,MAX_SAFE_INTEGER:t}=K(),{safeRe:r,t:s}=z(),l=Ze(),{compareIdentifiers:c}=st();class u{constructor(a,e){if(e=l(e),a instanceof u){if(a.loose===!!e.loose&&a.includePrerelease===!!e.includePrerelease)return a;a=a.version}else if(typeof a!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof a}".`);if(a.length>n)throw new TypeError(`version is longer than ${n} characters`);i("SemVer",a,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const f=a.trim().match(e.loose?r[s.LOOSE]:r[s.FULL]);if(!f)throw new TypeError(`Invalid Version: ${a}`);if(this.raw=a,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const m=+h;if(m>=0&&m<t)return m}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(a){if(i("SemVer.compare",this.version,this.options,a),!(a instanceof u)){if(typeof a=="string"&&a===this.version)return 0;a=new u(a,this.options)}return a.version===this.version?0:this.compareMain(a)||this.comparePre(a)}compareMain(a){return a instanceof u||(a=new u(a,this.options)),c(this.major,a.major)||c(this.minor,a.minor)||c(this.patch,a.patch)}comparePre(a){if(a instanceof u||(a=new u(a,this.options)),this.prerelease.length&&!a.prerelease.length)return-1;if(!this.prerelease.length&&a.prerelease.length)return 1;if(!this.prerelease.length&&!a.prerelease.length)return 0;let e=0;do{const f=this.prerelease[e],h=a.prerelease[e];if(i("prerelease compare",e,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return c(f,h)}while(++e)}compareBuild(a){a instanceof u||(a=new u(a,this.options));let e=0;do{const f=this.build[e],h=a.build[e];if(i("build compare",e,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return c(f,h)}while(++e)}inc(a,e,f){if(a.startsWith("pre")){if(!e&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(e){const h=`-${e}`.match(this.options.loose?r[s.PRERELEASELOOSE]:r[s.PRERELEASE]);if(!h||h[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(a){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,f),this.inc("pre",e,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,f),this.inc("pre",e,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let m=this.prerelease.length;for(;--m>=0;)typeof this.prerelease[m]=="number"&&(this.prerelease[m]++,m=-2);if(m===-1){if(e===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(e){let m=[e,h];f===!1&&(m=[e]),c(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=m):this.prerelease=m}break}default:throw new Error(`invalid increment argument: ${a}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return ue=u,ue}var le,pr;function X(){if(pr)return le;pr=1;const i=_();return le=(t,r,s=!1)=>{if(t instanceof i)return t;try{return new i(t,r)}catch(l){if(!s)return null;throw l}},le}var fe,Er;function $t(){if(Er)return fe;Er=1;const i=X();return fe=(t,r)=>{const s=i(t,r);return s?s.version:null},fe}var he,mr;function Lt(){if(mr)return he;mr=1;const i=X();return he=(t,r)=>{const s=i(t.trim().replace(/^[=v]+/,""),r);return s?s.version:null},he}var de,Rr;function St(){if(Rr)return de;Rr=1;const i=_();return de=(t,r,s,l,c)=>{typeof s=="string"&&(c=l,l=s,s=void 0);try{return new i(t instanceof i?t.version:t,s).inc(r,l,c).version}catch{return null}},de}var pe,vr;function wt(){if(vr)return pe;vr=1;const i=X();return pe=(t,r)=>{const s=i(t,null,!0),l=i(r,null,!0),c=s.compare(l);if(c===0)return null;const u=c>0,o=u?s:l,a=u?l:s,e=!!o.prerelease.length;if(!!a.prerelease.length&&!e){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}const h=e?"pre":"";return s.major!==l.major?h+"major":s.minor!==l.minor?h+"minor":s.patch!==l.patch?h+"patch":"prerelease"},pe}var Ee,Ir;function Nt(){if(Ir)return Ee;Ir=1;const i=_();return Ee=(t,r)=>new i(t,r).major,Ee}var me,gr;function Tt(){if(gr)return me;gr=1;const i=_();return me=(t,r)=>new i(t,r).minor,me}var Re,$r;function Ot(){if($r)return Re;$r=1;const i=_();return Re=(t,r)=>new i(t,r).patch,Re}var ve,Lr;function At(){if(Lr)return ve;Lr=1;const i=X();return ve=(t,r)=>{const s=i(t,r);return s&&s.prerelease.length?s.prerelease:null},ve}var Ie,Sr;function j(){if(Sr)return Ie;Sr=1;const i=_();return Ie=(t,r,s)=>new i(t,s).compare(new i(r,s)),Ie}var ge,wr;function Pt(){if(wr)return ge;wr=1;const i=j();return ge=(t,r,s)=>i(r,t,s),ge}var $e,Nr;function yt(){if(Nr)return $e;Nr=1;const i=j();return $e=(t,r)=>i(t,r,!0),$e}var Le,Tr;function Je(){if(Tr)return Le;Tr=1;const i=_();return Le=(t,r,s)=>{const l=new i(t,s),c=new i(r,s);return l.compare(c)||l.compareBuild(c)},Le}var Se,Or;function Ct(){if(Or)return Se;Or=1;const i=Je();return Se=(t,r)=>t.sort((s,l)=>i(s,l,r)),Se}var we,Ar;function qt(){if(Ar)return we;Ar=1;const i=Je();return we=(t,r)=>t.sort((s,l)=>i(l,s,r)),we}var Ne,Pr;function J(){if(Pr)return Ne;Pr=1;const i=j();return Ne=(t,r,s)=>i(t,r,s)>0,Ne}var Te,yr;function Qe(){if(yr)return Te;yr=1;const i=j();return Te=(t,r,s)=>i(t,r,s)<0,Te}var Oe,Cr;function nt(){if(Cr)return Oe;Cr=1;const i=j();return Oe=(t,r,s)=>i(t,r,s)===0,Oe}var Ae,qr;function it(){if(qr)return Ae;qr=1;const i=j();return Ae=(t,r,s)=>i(t,r,s)!==0,Ae}var Pe,xr;function er(){if(xr)return Pe;xr=1;const i=j();return Pe=(t,r,s)=>i(t,r,s)>=0,Pe}var ye,br;function rr(){if(br)return ye;br=1;const i=j();return ye=(t,r,s)=>i(t,r,s)<=0,ye}var Ce,Dr;function at(){if(Dr)return Ce;Dr=1;const i=nt(),n=it(),t=J(),r=er(),s=Qe(),l=rr();return Ce=(u,o,a,e)=>{switch(o){case"===":return typeof u=="object"&&(u=u.version),typeof a=="object"&&(a=a.version),u===a;case"!==":return typeof u=="object"&&(u=u.version),typeof a=="object"&&(a=a.version),u!==a;case"":case"=":case"==":return i(u,a,e);case"!=":return n(u,a,e);case">":return t(u,a,e);case">=":return r(u,a,e);case"<":return s(u,a,e);case"<=":return l(u,a,e);default:throw new TypeError(`Invalid operator: ${o}`)}},Ce}var qe,Ur;function xt(){if(Ur)return qe;Ur=1;const i=_(),n=X(),{safeRe:t,t:r}=z();return qe=(l,c)=>{if(l instanceof i)return l;if(typeof l=="number"&&(l=String(l)),typeof l!="string")return null;c=c||{};let u=null;if(!c.rtl)u=l.match(c.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const m=c.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let N;for(;(N=m.exec(l))&&(!u||u.index+u[0].length!==l.length);)(!u||N.index+N[0].length!==u.index+u[0].length)&&(u=N),m.lastIndex=N.index+N[1].length+N[2].length;m.lastIndex=-1}if(u===null)return null;const o=u[2],a=u[3]||"0",e=u[4]||"0",f=c.includePrerelease&&u[5]?`-${u[5]}`:"",h=c.includePrerelease&&u[6]?`+${u[6]}`:"";return n(`${o}.${a}.${e}${f}${h}`,c)},qe}var xe,_r;function bt(){if(_r)return xe;_r=1;class i{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const l=this.map.keys().next().value;this.delete(l)}this.map.set(t,r)}return this}}return xe=i,xe}var be,Gr;function k(){if(Gr)return be;Gr=1;const i=/\s+/g;class n{constructor(d,I){if(I=s(I),d instanceof n)return d.loose===!!I.loose&&d.includePrerelease===!!I.includePrerelease?d:new n(d.raw,I);if(d instanceof l)return this.raw=d.value,this.set=[[d]],this.formatted=void 0,this;if(this.options=I,this.loose=!!I.loose,this.includePrerelease=!!I.includePrerelease,this.raw=d.trim().replace(i," "),this.set=this.raw.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const R=this.set[0];if(this.set=this.set.filter(g=>!p(g[0])),this.set.length===0)this.set=[R];else if(this.set.length>1){for(const g of this.set)if(g.length===1&&w(g[0])){this.set=[g];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let d=0;d<this.set.length;d++){d>0&&(this.formatted+="||");const I=this.set[d];for(let R=0;R<I.length;R++)R>0&&(this.formatted+=" "),this.formatted+=I[R].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(d){const R=((this.options.includePrerelease&&m)|(this.options.loose&&N))+":"+d,g=r.get(R);if(g)return g;const v=this.options.loose,$=v?o[a.HYPHENRANGELOOSE]:o[a.HYPHENRANGE];d=d.replace($,se(this.options.includePrerelease)),c("hyphen replace",d),d=d.replace(o[a.COMPARATORTRIM],e),c("comparator trim",d),d=d.replace(o[a.TILDETRIM],f),c("tilde trim",d),d=d.replace(o[a.CARETTRIM],h),c("caret trim",d);let T=d.split(" ").map(q=>b(q,this.options)).join(" ").split(/\s+/).map(q=>te(q,this.options));v&&(T=T.filter(q=>(c("loose invalid filter",q,this.options),!!q.match(o[a.COMPARATORLOOSE])))),c("range list",T);const S=new Map,P=T.map(q=>new l(q,this.options));for(const q of P){if(p(q))return[q];S.set(q.value,q)}S.size>1&&S.has("")&&S.delete("");const U=[...S.values()];return r.set(R,U),U}intersects(d,I){if(!(d instanceof n))throw new TypeError("a Range is required");return this.set.some(R=>O(R,I)&&d.set.some(g=>O(g,I)&&R.every(v=>g.every($=>v.intersects($,I)))))}test(d){if(!d)return!1;if(typeof d=="string")try{d=new u(d,this.options)}catch{return!1}for(let I=0;I<this.set.length;I++)if(ne(this.set[I],d,this.options))return!0;return!1}}be=n;const t=bt(),r=new t,s=Ze(),l=Q(),c=Z(),u=_(),{safeRe:o,t:a,comparatorTrimReplace:e,tildeTrimReplace:f,caretTrimReplace:h}=z(),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:N}=K(),p=E=>E.value==="<0.0.0-0",w=E=>E.value==="",O=(E,d)=>{let I=!0;const R=E.slice();let g=R.pop();for(;I&&R.length;)I=R.every(v=>g.intersects(v,d)),g=R.pop();return I},b=(E,d)=>(c("comp",E,d),E=y(E,d),c("caret",E),E=D(E,d),c("tildes",E),E=L(E,d),c("xrange",E),E=re(E,d),c("stars",E),E),A=E=>!E||E.toLowerCase()==="x"||E==="*",D=(E,d)=>E.trim().split(/\s+/).map(I=>G(I,d)).join(" "),G=(E,d)=>{const I=d.loose?o[a.TILDELOOSE]:o[a.TILDE];return E.replace(I,(R,g,v,$,T)=>{c("tilde",E,R,g,v,$,T);let S;return A(g)?S="":A(v)?S=`>=${g}.0.0 <${+g+1}.0.0-0`:A($)?S=`>=${g}.${v}.0 <${g}.${+v+1}.0-0`:T?(c("replaceTilde pr",T),S=`>=${g}.${v}.${$}-${T} <${g}.${+v+1}.0-0`):S=`>=${g}.${v}.${$} <${g}.${+v+1}.0-0`,c("tilde return",S),S})},y=(E,d)=>E.trim().split(/\s+/).map(I=>x(I,d)).join(" "),x=(E,d)=>{c("caret",E,d);const I=d.loose?o[a.CARETLOOSE]:o[a.CARET],R=d.includePrerelease?"-0":"";return E.replace(I,(g,v,$,T,S)=>{c("caret",E,g,v,$,T,S);let P;return A(v)?P="":A($)?P=`>=${v}.0.0${R} <${+v+1}.0.0-0`:A(T)?v==="0"?P=`>=${v}.${$}.0${R} <${v}.${+$+1}.0-0`:P=`>=${v}.${$}.0${R} <${+v+1}.0.0-0`:S?(c("replaceCaret pr",S),v==="0"?$==="0"?P=`>=${v}.${$}.${T}-${S} <${v}.${$}.${+T+1}-0`:P=`>=${v}.${$}.${T}-${S} <${v}.${+$+1}.0-0`:P=`>=${v}.${$}.${T}-${S} <${+v+1}.0.0-0`):(c("no pr"),v==="0"?$==="0"?P=`>=${v}.${$}.${T}${R} <${v}.${$}.${+T+1}-0`:P=`>=${v}.${$}.${T}${R} <${v}.${+$+1}.0-0`:P=`>=${v}.${$}.${T} <${+v+1}.0.0-0`),c("caret return",P),P})},L=(E,d)=>(c("replaceXRanges",E,d),E.split(/\s+/).map(I=>B(I,d)).join(" ")),B=(E,d)=>{E=E.trim();const I=d.loose?o[a.XRANGELOOSE]:o[a.XRANGE];return E.replace(I,(R,g,v,$,T,S)=>{c("xRange",E,R,g,v,$,T,S);const P=A(v),U=P||A($),q=U||A(T),V=q;return g==="="&&V&&(g=""),S=d.includePrerelease?"-0":"",P?g===">"||g==="<"?R="<0.0.0-0":R="*":g&&V?(U&&($=0),T=0,g===">"?(g=">=",U?(v=+v+1,$=0,T=0):($=+$+1,T=0)):g==="<="&&(g="<",U?v=+v+1:$=+$+1),g==="<"&&(S="-0"),R=`${g+v}.${$}.${T}${S}`):U?R=`>=${v}.0.0${S} <${+v+1}.0.0-0`:q&&(R=`>=${v}.${$}.0${S} <${v}.${+$+1}.0-0`),c("xRange return",R),R})},re=(E,d)=>(c("replaceStars",E,d),E.trim().replace(o[a.STAR],"")),te=(E,d)=>(c("replaceGTE0",E,d),E.trim().replace(o[d.includePrerelease?a.GTE0PRE:a.GTE0],"")),se=E=>(d,I,R,g,v,$,T,S,P,U,q,V)=>(A(R)?I="":A(g)?I=`>=${R}.0.0${E?"-0":""}`:A(v)?I=`>=${R}.${g}.0${E?"-0":""}`:$?I=`>=${I}`:I=`>=${I}${E?"-0":""}`,A(P)?S="":A(U)?S=`<${+P+1}.0.0-0`:A(q)?S=`<${P}.${+U+1}.0-0`:V?S=`<=${P}.${U}.${q}-${V}`:E?S=`<${P}.${U}.${+q+1}-0`:S=`<=${S}`,`${I} ${S}`.trim()),ne=(E,d,I)=>{for(let R=0;R<E.length;R++)if(!E[R].test(d))return!1;if(d.prerelease.length&&!I.includePrerelease){for(let R=0;R<E.length;R++)if(c(E[R].semver),E[R].semver!==l.ANY&&E[R].semver.prerelease.length>0){const g=E[R].semver;if(g.major===d.major&&g.minor===d.minor&&g.patch===d.patch)return!0}return!1}return!0};return be}var De,Fr;function Q(){if(Fr)return De;Fr=1;const i=Symbol("SemVer ANY");class n{static get ANY(){return i}constructor(e,f){if(f=t(f),e instanceof n){if(e.loose===!!f.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,f),this.options=f,this.loose=!!f.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const f=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],h=e.match(f);if(!h)throw new TypeError(`Invalid comparator: ${e}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new u(h[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if(typeof e=="string")try{e=new u(e,this.options)}catch{return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,f){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(e.value,f).test(this.value):e.operator===""?e.value===""?!0:new o(this.value,f).test(e.semver):(f=t(f),f.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,f)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,f)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}De=n;const t=Ze(),{safeRe:r,t:s}=z(),l=at(),c=Z(),u=_(),o=k();return De}var Ue,jr;function ee(){if(jr)return Ue;jr=1;const i=k();return Ue=(t,r,s)=>{try{r=new i(r,s)}catch{return!1}return r.test(t)},Ue}var _e,kr;function Dt(){if(kr)return _e;kr=1;const i=k();return _e=(t,r)=>new i(t,r).set.map(s=>s.map(l=>l.value).join(" ").trim().split(" ")),_e}var Ge,Mr;function Ut(){if(Mr)return Ge;Mr=1;const i=_(),n=k();return Ge=(r,s,l)=>{let c=null,u=null,o=null;try{o=new n(s,l)}catch{return null}return r.forEach(a=>{o.test(a)&&(!c||u.compare(a)===-1)&&(c=a,u=new i(c,l))}),c},Ge}var Fe,Xr;function _t(){if(Xr)return Fe;Xr=1;const i=_(),n=k();return Fe=(r,s,l)=>{let c=null,u=null,o=null;try{o=new n(s,l)}catch{return null}return r.forEach(a=>{o.test(a)&&(!c||u.compare(a)===1)&&(c=a,u=new i(c,l))}),c},Fe}var je,Br;function Gt(){if(Br)return je;Br=1;const i=_(),n=k(),t=J();return je=(s,l)=>{s=new n(s,l);let c=new i("0.0.0");if(s.test(c)||(c=new i("0.0.0-0"),s.test(c)))return c;c=null;for(let u=0;u<s.set.length;++u){const o=s.set[u];let a=null;o.forEach(e=>{const f=new i(e.semver.version);switch(e.operator){case">":f.prerelease.length===0?f.patch++:f.prerelease.push(0),f.raw=f.format();case"":case">=":(!a||t(f,a))&&(a=f);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}),a&&(!c||t(c,a))&&(c=a)}return c&&s.test(c)?c:null},je}var ke,Vr;function Ft(){if(Vr)return ke;Vr=1;const i=k();return ke=(t,r)=>{try{return new i(t,r).range||"*"}catch{return null}},ke}var Me,zr;function tr(){if(zr)return Me;zr=1;const i=_(),n=Q(),{ANY:t}=n,r=k(),s=ee(),l=J(),c=Qe(),u=rr(),o=er();return Me=(e,f,h,m)=>{e=new i(e,m),f=new r(f,m);let N,p,w,O,b;switch(h){case">":N=l,p=u,w=c,O=">",b=">=";break;case"<":N=c,p=o,w=l,O="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,f,m))return!1;for(let A=0;A<f.set.length;++A){const D=f.set[A];let G=null,y=null;if(D.forEach(x=>{x.semver===t&&(x=new n(">=0.0.0")),G=G||x,y=y||x,N(x.semver,G.semver,m)?G=x:w(x.semver,y.semver,m)&&(y=x)}),G.operator===O||G.operator===b||(!y.operator||y.operator===O)&&p(e,y.semver))return!1;if(y.operator===b&&w(e,y.semver))return!1}return!0},Me}var Xe,Hr;function jt(){if(Hr)return Xe;Hr=1;const i=tr();return Xe=(t,r,s)=>i(t,r,">",s),Xe}var Be,Yr;function kt(){if(Yr)return Be;Yr=1;const i=tr();return Be=(t,r,s)=>i(t,r,"<",s),Be}var Ve,Wr;function Mt(){if(Wr)return Ve;Wr=1;const i=k();return Ve=(t,r,s)=>(t=new i(t,s),r=new i(r,s),t.intersects(r,s)),Ve}var ze,Kr;function Xt(){if(Kr)return ze;Kr=1;const i=ee(),n=j();return ze=(t,r,s)=>{const l=[];let c=null,u=null;const o=t.sort((h,m)=>n(h,m,s));for(const h of o)i(h,r,s)?(u=h,c||(c=h)):(u&&l.push([c,u]),u=null,c=null);c&&l.push([c,null]);const a=[];for(const[h,m]of l)h===m?a.push(h):!m&&h===o[0]?a.push("*"):m?h===o[0]?a.push(`<=${m}`):a.push(`${h} - ${m}`):a.push(`>=${h}`);const e=a.join(" || "),f=typeof r.raw=="string"?r.raw:String(r);return e.length<f.length?e:r},ze}var He,Zr;function Bt(){if(Zr)return He;Zr=1;const i=k(),n=Q(),{ANY:t}=n,r=ee(),s=j(),l=(f,h,m={})=>{if(f===h)return!0;f=new i(f,m),h=new i(h,m);let N=!1;e:for(const p of f.set){for(const w of h.set){const O=o(p,w,m);if(N=N||O!==null,O)continue e}if(N)return!1}return!0},c=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],o=(f,h,m)=>{if(f===h)return!0;if(f.length===1&&f[0].semver===t){if(h.length===1&&h[0].semver===t)return!0;m.includePrerelease?f=c:f=u}if(h.length===1&&h[0].semver===t){if(m.includePrerelease)return!0;h=u}const N=new Set;let p,w;for(const L of f)L.operator===">"||L.operator===">="?p=a(p,L,m):L.operator==="<"||L.operator==="<="?w=e(w,L,m):N.add(L.semver);if(N.size>1)return null;let O;if(p&&w){if(O=s(p.semver,w.semver,m),O>0)return null;if(O===0&&(p.operator!==">="||w.operator!=="<="))return null}for(const L of N){if(p&&!r(L,String(p),m)||w&&!r(L,String(w),m))return null;for(const B of h)if(!r(L,String(B),m))return!1;return!0}let b,A,D,G,y=w&&!m.includePrerelease&&w.semver.prerelease.length?w.semver:!1,x=p&&!m.includePrerelease&&p.semver.prerelease.length?p.semver:!1;y&&y.prerelease.length===1&&w.operator==="<"&&y.prerelease[0]===0&&(y=!1);for(const L of h){if(G=G||L.operator===">"||L.operator===">=",D=D||L.operator==="<"||L.operator==="<=",p){if(x&&L.semver.prerelease&&L.semver.prerelease.length&&L.semver.major===x.major&&L.semver.minor===x.minor&&L.semver.patch===x.patch&&(x=!1),L.operator===">"||L.operator===">="){if(b=a(p,L,m),b===L&&b!==p)return!1}else if(p.operator===">="&&!r(p.semver,String(L),m))return!1}if(w){if(y&&L.semver.prerelease&&L.semver.prerelease.length&&L.semver.major===y.major&&L.semver.minor===y.minor&&L.semver.patch===y.patch&&(y=!1),L.operator==="<"||L.operator==="<="){if(A=e(w,L,m),A===L&&A!==w)return!1}else if(w.operator==="<="&&!r(w.semver,String(L),m))return!1}if(!L.operator&&(w||p)&&O!==0)return!1}return!(p&&D&&!w&&O!==0||w&&G&&!p&&O!==0||x||y)},a=(f,h,m)=>{if(!f)return h;const N=s(f.semver,h.semver,m);return N>0?f:N<0||h.operator===">"&&f.operator===">="?h:f},e=(f,h,m)=>{if(!f)return h;const N=s(f.semver,h.semver,m);return N<0?f:N>0||h.operator==="<"&&f.operator==="<="?h:f};return He=l,He}var Ye,Jr;function Vt(){if(Jr)return Ye;Jr=1;const i=z(),n=K(),t=_(),r=st(),s=X(),l=$t(),c=Lt(),u=St(),o=wt(),a=Nt(),e=Tt(),f=Ot(),h=At(),m=j(),N=Pt(),p=yt(),w=Je(),O=Ct(),b=qt(),A=J(),D=Qe(),G=nt(),y=it(),x=er(),L=rr(),B=at(),re=xt(),te=Q(),se=k(),ne=ee(),E=Dt(),d=Ut(),I=_t(),R=Gt(),g=Ft(),v=tr(),$=jt(),T=kt(),S=Mt(),P=Xt(),U=Bt();return Ye={parse:s,valid:l,clean:c,inc:u,diff:o,major:a,minor:e,patch:f,prerelease:h,compare:m,rcompare:N,compareLoose:p,compareBuild:w,sort:O,rsort:b,gt:A,lt:D,eq:G,neq:y,gte:x,lte:L,cmp:B,coerce:re,Comparator:te,Range:se,satisfies:ne,toComparators:E,maxSatisfying:d,minSatisfying:I,minVersion:R,validRange:g,outside:v,gtr:$,ltr:T,intersects:S,simplifyRange:P,subset:U,SemVer:t,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},Ye}var zt=Vt();const Qr=dt(zt);var C;(function(i){i.blue="blue",i.nanoS="nanoS",i.nanoSP="nanoSP",i.nanoX="nanoX",i.stax="stax",i.europa="europa",i.apex="apex"})(C||(C={}));const We={[C.blue]:{id:C.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:i=>4*1024},[C.nanoS]:{id:C.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:i=>Qr.lt(Qr.coerce(i)??"","2.0.0")?4*1024:2*1024},[C.nanoX]:{id:C.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:i=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[C.nanoSP]:{id:C.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:i=>32},[C.apex]:{id:C.apex,productName:"Ledger Apex",productIdMM:128,legacyUsbProductId:8,usbOnly:!1,memorySize:1533*1024,masks:[859832320],getBlockSize:i=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[C.stax]:{id:C.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:i=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[C.europa]:{id:C.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:i=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};C.blue,C.nanoS,C.nanoSP,C.nanoX,C.stax,C.europa;const et=Object.values(We),ot=11415,rt=i=>{const n=et.find(s=>s.legacyUsbProductId===i);if(n)return n;const t=i>>8;return et.find(s=>s.productIdMM===t)},Ht=[],tt={};for(const i in We){const n=We[i],{bluetoothSpec:t}=n;if(t)for(let r=0;r<t.length;r++){const s=t[r];Ht.push(s.serviceUuid),tt[s.serviceUuid]=tt[s.serviceUuid.replace(/-/g,"")]={deviceModel:n,...s}}}const Yt=[{vendorId:ot}],Wt=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),W=()=>{const{hid:i}=navigator;if(!i)throw new M("navigator.hid is not supported","HIDNotSupported");return i};async function ct(){const i=await W().requestDevice({filters:Yt});return Array.isArray(i)?i:[i]}async function Ke(){return(await W().getDevices()).filter(n=>n.vendorId===ot)}async function Kt(){const i=await Ke();return i.length>0?i[0]:(await ct())[0]}class Y extends Rt{device;deviceModel;channel=Math.floor(Math.random()*65535);packetSize=64;constructor(n){super(),this.device=n,this.deviceModel=typeof n.productId=="number"?rt(n.productId):void 0,n.addEventListener("inputreport",this.onInputReport)}inputs=[];inputCallback;read=()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(n=>{this.inputCallback=n});onInputReport=n=>{const t=F.from(n.data.buffer);this.inputCallback?(this.inputCallback(t),this.inputCallback=null):this.inputs.push(t)};static isSupported=Wt;static list=Ke;static listen=n=>{let t=!1;Kt().then(s=>{if(!s)n.error(new ir("Access denied to use Ledger device"));else if(!t){const l=typeof s.productId=="number"?rt(s.productId):void 0;n.next({type:"add",descriptor:s,deviceModel:l}),n.complete()}},s=>{n.error(new ir(s.message))});function r(){t=!0}return{unsubscribe:r}};static async request(){const[n]=await ct();return Y.open(n)}static async openConnected(){const n=await Ke();return n.length===0?null:Y.open(n[0])}static async open(n){await n.open();const t=new Y(n),r=s=>{n===s.device&&(W().removeEventListener("disconnect",r),t._emitDisconnect(new Et))};return W().addEventListener("disconnect",r),t}_disconnectEmitted=!1;_emitDisconnect=n=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",n))};async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}exchange=async n=>await this.exchangeAtomicImpl(async()=>{const{channel:r,packetSize:s}=this;ar("apdu","=> "+n.toString("hex"));const l=gt(r,s),c=l.makeBlocks(n);for(let a=0;a<c.length;a++)await this.device.sendReport(0,c[a]);let u,o;for(;!(u=l.getReducedResult(o));)try{const a=await this.read();o=l.reduceResponse(o,a)}catch(a){if(a instanceof M&&a.id==="InvalidChannel")continue;throw a}return ar("apdu","<= "+u.toString("hex")),u}).catch(r=>{throw r&&r.message&&r.message.includes("write")?(this._emitDisconnect(r),new pt(r.message)):r});setScrambleKey(){}}export{Y as default};
